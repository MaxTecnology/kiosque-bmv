import{a as R}from"./chunk-SKS2ED2I.js";import{a as be}from"./chunk-2TO534EY.js";import"./chunk-RSPORLB7.js";import{$ as ee,Cb as ge,Fb as B,G as i,H as C,J,K as v,Kb as he,Lb as ve,M as d,O as a,Oa as N,P as o,Pa as ie,Q as w,Sa as z,T as K,Ta as ne,U as O,Ua as oe,V as k,Va as re,Wa as ae,Xa as pe,Y as j,Ya as se,Z,Za as le,_ as $,_a as de,aa as F,ab as me,ba as p,bb as ce,ca as f,cb as ue,da as h,e as Y,ec as Se,fa as y,ga as E,gc as P,ha as I,jc as H,kb as M,lb as T,lc as A,ma as m,na as c,nb as D,nc as _e,ob as fe,p as x,s as b,sc as q,t as L,ta as te,tc as Ce,x as S,y as _}from"./chunk-K77LY3FL.js";import"./chunk-B4AJQJMI.js";var Ee=(()=>{class e{static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275cmp=b({type:e,selectors:[["coupons"]],decls:1,vars:0,template:function(r,n){r&1&&w(0,"router-outlet")},dependencies:[ie],encapsulation:2})}}return e})();var Ie=(()=>{class e extends be{constructor(t,r,n){super(r),this.client=t,this.coreService=r,this.route=n,this.columns=[{key:"code",translation_key:"COUPON.FIELDS.CODE.LABEL",column:{title:"",type:"string",filter:!1}},{key:"type",translation_key:"COUPON.FIELDS.TYPE.LABEL",column:{title:"",type:"string",filter:!1}}],this.editPageUrl="pages/coupons/edit",this.actionSettings={actions:{columnTitle:"Action",position:"right",add:!1}}}ngOnInit(){super.ngOnInit(this.client.getBaseEndpoint())}delete(t){super.delete(t)}static{this.\u0275fac=function(r){return new(r||e)(C(R),C(A),C(N))}}static{this.\u0275cmp=b({type:e,selectors:[["list"]],features:[J],decls:6,vars:6,consts:[["nbSpinnerStatus","danger",3,"nbSpinner"],[3,"delete","edit","settings","source"]],template:function(r,n){r&1&&(a(0,"nb-card")(1,"nb-card-header"),p(2),m(3,"translate"),o(),a(4,"nb-card-body",0)(5,"angular2-smart-table",1),O("delete",function(g){return n.onDeleteConfirm(g)})("edit",function(g){return n.edit(g)}),o()()()),r&2&&(i(2),h(" ",c(3,4,"COUPON.LABELS.LIST")," "),i(2),d("nbSpinner",n.loading),i(),d("settings",n.settings)("source",n.source))},dependencies:[B,D,T,M,Se,P],styles:[`[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{transform:translateZ(0)}





`]})}}return e})();var W=class{};var G=class{constructor(){this.meta={}}};var U=class{};function Ne(e,u){if(e&1&&(a(0,"div",13)(1,"label"),p(2),m(3,"translate"),a(4,"span",23),p(5),m(6,"languageTitle"),o()(),w(7,"input",24),o()),e&2){let t=u.index,r=k();i(2),h("",c(3,3,"COUPON.FIELDS.TITLE.LABEL")," "),i(3),f(c(6,5,r.languages[t])),i(2),j("formControlName",t)}}function Me(e,u){if(e&1&&(a(0,"label",25),p(1),o()),e&2){let t=u.$implicit;i(),f(t)}}function Te(e,u){if(e&1&&(a(0,"div",13)(1,"label"),p(2),m(3,"translate"),a(4,"span",23),p(5),m(6,"languageTitle"),o()(),w(7,"input",24),o()),e&2){let t=u.index,r=k();i(2),h("",c(3,3,"COUPON.FIELDS.DETAIL.LABEL")," "),i(3),f(c(6,5,r.languages[t])),i(2),j("formControlName",t)}}function De(e,u){if(e&1&&(a(0,"label",25),p(1),o()),e&2){let t=u.$implicit;i(),f(t)}}function Be(e,u){if(e&1&&(a(0,"label",25),p(1),o()),e&2){let t=u.$implicit;i(),f(t)}}function Re(e,u){if(e&1&&(a(0,"nb-option",26),p(1),o()),e&2){let t=u.$implicit;d("value",t),i(),h("",t," ")}}function Pe(e,u){if(e&1&&(a(0,"label",25),p(1),o()),e&2){let t=u.$implicit;i(),f(t)}}function Ae(e,u){if(e&1&&(a(0,"label",25),p(1),o()),e&2){let t=u.$implicit;i(),f(t)}}function qe(e,u){if(e&1&&(a(0,"label",25),p(1),o()),e&2){let t=u.$implicit;i(),f(t)}}var Q=(()=>{class e{constructor(t,r,n){this.client=t,this.coreService=r,this.route=n,this.coupon=new W,this.couponRequest=new G,this.couponError=new U,this.showProgress=!1,this.showProgressButton=!1,this.isEdit=!1,this.editId=null,this.typeList=["fixed","percent"],this.languages=[],this.languages=r.translationService.languages}ngOnInit(){this.titleGroupForm=this.coreService.translationService.buildFormGroup(null),this.detailGroupForm=this.coreService.translationService.buildFormGroup(null),this.getEditData()}ngAfterViewInit(){}getEditData(){let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.editId=t,this.getDataById(t).subscribe())}getDataById(t){return this.showProgress=!0,this.client.show(t).pipe(Y(r=>(this.showProgress=!1,this.coupon=r,this.titleGroupForm=this.coreService.translationService.buildFormGroup(this.coupon.title_translations),this.detailGroupForm=this.coreService.translationService.buildFormGroup(this.coupon.detail_translations),this.couponRequest.code=this.coupon.code,this.couponRequest.reward=this.coupon.reward,this.couponRequest.type=this.coupon.type,this.couponRequest.expires_at=this.coupon.expires_at,this.couponRequest.meta=this.coupon.meta,r)))}saveCoupon(){this.metaeditorComponent.updatedMetaProperty(),this.showProgressButton=!0;let t=new FormData;t.append("title_translations",this.coreService.translationService.buildRequestParam(this.titleGroupForm)),t.append("detail_translations",this.coreService.translationService.buildRequestParam(this.detailGroupForm)),t.append("code",this.couponRequest.code),t.append("reward",String(this.couponRequest.reward)),t.append("type",this.couponRequest.type),t.append("expires_at",this.couponRequest.expires_at),t.append("meta",JSON.stringify(this.couponRequest.meta)),(this.isEdit?this.client.update(this.editId,t):this.client.store(t)).subscribe(n=>{this.showProgressButton=!1,this.coreService.toastService.showToast(H.SUCCESS,"Saved","Saved successfully!"),this.back()},n=>{if(this.showProgressButton=!1,this.coreService.toastService.showToast(H.DANGER,"Failed",n.error.message),n.error.errors){let l=n.error.errors;this.couponError.title_translations=l?.title_translations,this.couponError.detail_translations=l?.detail_translations,this.couponError.code=l?.code,this.couponError.reward=l?.reward,this.couponError.type=l?.type,this.couponError.expires_at=l?.expires_at}})}back(){this.coreService.location.back()}getTitleItems(){return this.titleGroupForm.get("items")}getDetailItems(){return this.detailGroupForm.get("items")}static{this.\u0275fac=function(r){return new(r||e)(C(R),C(A),C(N))}}static{this.\u0275cmp=b({type:e,selectors:[["save"]],viewQuery:function(r,n){if(r&1&&Z(q,5),r&2){let l;$(l=ee())&&(n.metaeditorComponent=l.first)}},decls:74,vars:55,consts:[["form","ngForm"],["code","ngModel"],["type","ngModel"],["reward","ngModel"],["expires_at","ngModel"],[1,"row"],[1,"col-md-12"],["nbSpinnerStatus","danger",3,"nbSpinner"],[3,"ngSubmit"],[3,"formGroup"],["formArrayName","items"],["class","form-group",4,"ngFor","ngForOf"],["class","error text-danger",4,"ngFor","ngForOf"],[1,"form-group"],["type","text","nbInput","","fullWidth","","placeholder","Code","name","code","required","",3,"ngModelChange","ngModel"],[1,"error","text-danger",3,"hidden"],["fullWidth","","name","type","id","type",2,"text-transform","capitalize",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","number","nbInput","","fullWidth","","placeholder","Reward","name","reward","required","",3,"ngModelChange","ngModel"],["type","date","nbInput","","fullWidth","","placeholder","Expires At","name","expires_at","required","",3,"ngModelChange","ngModel"],[3,"metaChange","meta"],["type","submit","nbButton","","status","success","size","medium","nbSpinnerStatus","success","nbSpinnerSize","small",3,"disabled","nbSpinner"],["type","button","nbButton","","status","danger","size","medium",3,"click"],[1,"language-label"],["type","text","nbInput","","fullWidth","","required","",3,"formControlName"],[1,"error","text-danger"],[3,"value"]],template:function(r,n){if(r&1){let l=K();a(0,"div",5)(1,"div",6)(2,"nb-card")(3,"nb-card-body",7)(4,"form",8,0),O("ngSubmit",function(){return S(l),_(n.saveCoupon())}),a(6,"div",5)(7,"div",6)(8,"nb-card")(9,"nb-card-header"),p(10),m(11,"translate"),o(),a(12,"nb-card-body")(13,"div",9)(14,"div",10),v(15,Ne,8,7,"div",11),o()(),v(16,Me,2,1,"label",12),o()()()(),a(17,"div",5)(18,"div",6)(19,"nb-card")(20,"nb-card-header"),p(21),m(22,"translate"),o(),a(23,"nb-card-body")(24,"div",9)(25,"div",10),v(26,Te,8,7,"div",11),o()(),v(27,De,2,1,"label",12),o()()()(),a(28,"div",13)(29,"label"),p(30),m(31,"translate"),o(),a(32,"input",14,1),I("ngModelChange",function(s){return S(l),E(n.couponRequest.code,s)||(n.couponRequest.code=s),_(s)}),o(),a(34,"label",15),p(35),m(36,"translate"),o(),v(37,Be,2,1,"label",12),o(),a(38,"div",13)(39,"label"),p(40),m(41,"translate"),o(),a(42,"nb-select",16,2),I("ngModelChange",function(s){return S(l),E(n.couponRequest.type,s)||(n.couponRequest.type=s),_(s)}),v(44,Re,2,2,"nb-option",17),o(),v(45,Pe,2,1,"label",12),o(),a(46,"div",13)(47,"label"),p(48),m(49,"translate"),o(),a(50,"input",18,3),I("ngModelChange",function(s){return S(l),E(n.couponRequest.reward,s)||(n.couponRequest.reward=s),_(s)}),o(),a(52,"label",15),p(53),m(54,"translate"),o(),v(55,Ae,2,1,"label",12),o(),a(56,"div",13)(57,"label"),p(58),m(59,"translate"),o(),a(60,"input",19,4),I("ngModelChange",function(s){return S(l),E(n.couponRequest.expires_at,s)||(n.couponRequest.expires_at=s),_(s)}),o(),a(62,"label",15),p(63),m(64,"translate"),o(),v(65,qe,2,1,"label",12),o(),a(66,"ngx-metaeditor",20),I("metaChange",function(s){return S(l),E(n.couponRequest.meta,s)||(n.couponRequest.meta=s),_(s)}),o(),a(67,"button",21),p(68),m(69,"translate"),o(),p(70," \xA0 "),a(71,"button",22),O("click",function(){return S(l),_(n.back())}),p(72),m(73,"translate"),o()()()()()()}if(r&2){let l=F(5),g=F(33),s=F(51),X=F(61);i(3),d("nbSpinner",n.showProgress),i(7),f(c(11,33,"COUPON.FIELDS.TITLE.HEADER")),i(3),d("formGroup",n.titleGroupForm),i(2),d("ngForOf",n.getTitleItems().controls),i(),d("ngForOf",n.couponError.title_translations),i(5),f(c(22,35,"COUPON.FIELDS.DETAIL.HEADER")),i(3),d("formGroup",n.detailGroupForm),i(2),d("ngForOf",n.getDetailItems().controls),i(),d("ngForOf",n.couponError.detail_translations),i(3),f(c(31,37,"COUPON.FIELDS.CODE.LABEL")),i(2),y("ngModel",n.couponRequest.code),i(2),d("hidden",g.valid||g.pristine),i(),h(" ",c(36,39,"COUPON.FIELDS.CODE.VALIDATION")," "),i(2),d("ngForOf",n.couponError.code),i(3),f(c(41,41,"COUPON.FIELDS.TYPE.LABEL")),i(2),y("ngModel",n.couponRequest.type),i(2),d("ngForOf",n.typeList),i(),d("ngForOf",n.couponError.type),i(3),f(c(49,43,"COUPON.FIELDS.REWARD.LABEL")),i(2),y("ngModel",n.couponRequest.reward),i(2),d("hidden",s.valid||s.pristine),i(),h(" ",c(54,45,"COUPON.FIELDS.REWARD.VALIDATION")," "),i(2),d("ngForOf",n.couponError.reward),i(3),f(c(59,47,"COUPON.FIELDS.EXPIRES_AT.LABEL")),i(2),y("ngModel",n.couponRequest.expires_at),i(2),d("hidden",X.valid||X.pristine),i(),h(" ",c(64,49,"COUPON.FIELDS.EXPIRES_AT.VALIDATION")," "),i(2),d("ngForOf",n.couponError.expires_at),i(),y("meta",n.couponRequest.meta),i(),d("disabled",!l.form.valid||n.showProgressButton)("nbSpinner",n.showProgressButton),i(),h(" ",c(69,51,"COMMON.SAVE")," "),i(4),h(" ",c(73,53,"COMMON.BACK")," ")}},dependencies:[te,se,ne,le,oe,re,ue,pe,ae,de,ce,me,fe,ve,he,B,D,T,M,ge,q,P,_e],encapsulation:2})}}return e})();var Ve=[{path:"",component:Ee,children:[{path:"add",component:Q},{path:"list",component:Ie},{path:"edit/:id",component:Q}]}],we=(()=>{class e{static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275mod=L({type:e})}static{this.\u0275inj=x({imports:[z.forChild(Ve),z]})}}return e})();var ct=(()=>{class e{static{this.\u0275fac=function(r){return new(r||e)}}static{this.\u0275mod=L({type:e})}static{this.\u0275inj=x({imports:[Ce,we]})}}return e})();export{ct as CouponsModule};
