import{a as D}from"./chunk-O7WP6NWV.js";import{a as Te}from"./chunk-2TO534EY.js";import"./chunk-RSPORLB7.js";import{$ as ee,Cb as _e,F as H,Fb as N,G as r,H as h,J,Jb as Ce,K as v,Kb as ve,Lb as Se,M as m,O as a,Oa as M,P as o,Pa as re,Q as E,Sa as U,T as K,Ta as ne,U as b,Ua as oe,V as j,Va as ae,Wa as se,Xa as le,Y as Z,Ya as pe,Z as X,Za as me,_ as $,_a as de,aa as F,ab as ce,ba as l,bb as ue,ca as f,cb as ge,da as y,e as Y,ec as be,fa as I,ga as T,gb as fe,gc as x,ha as R,jb as he,jc as z,kb as A,lb as B,lc as q,ma as c,na as u,nb as O,nc as Ee,ob as ye,p as w,s as S,sc as G,t as L,ta as te,tc as Ie,ua as ie,x as _,y as C}from"./chunk-K77LY3FL.js";import"./chunk-B4AJQJMI.js";var we=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=S({type:t,selectors:[["categories"]],decls:1,vars:0,template:function(n,i){n&1&&E(0,"router-outlet")},dependencies:[re],encapsulation:2})}}return t})();var Le=(()=>{class t extends Te{constructor(e,n,i){super(n),this.client=e,this.coreService=n,this.route=i,this.columns=[{key:"title",translation_key:"CATEGORY.FIELDS.TITLE.LABEL",column:{title:"",type:"string"}},{key:"slug",translation_key:"CATEGORY.FIELDS.SLUG.LABEL",column:{title:"",type:"string"}},{key:"meta",translation_key:"CATEGORY.FIELDS.META_SCOPE.LABEL",column:{title:"",type:"string",filter:!1,valuePrepareFunction:s=>s.scope}}],this.editPageUrl="pages/categories/edit",this.actionSettings={actions:{columnTitle:"Action",position:"right",add:!1}}}ngOnInit(){super.ngOnInit(this.client.getBaseEndpoint())}static{this.\u0275fac=function(n){return new(n||t)(h(D),h(q),h(M))}}static{this.\u0275cmp=S({type:t,selectors:[["list"]],features:[J],decls:6,vars:6,consts:[["nbSpinnerStatus","danger",3,"nbSpinner"],[3,"delete","edit","settings","source"]],template:function(n,i){n&1&&(a(0,"nb-card")(1,"nb-card-header"),l(2),c(3,"translate"),o(),a(4,"nb-card-body",0)(5,"angular2-smart-table",1),b("delete",function(g){return i.onDeleteConfirm(g)})("edit",function(g){return i.edit(g)}),o()()()),n&2&&(r(2),y(" ",u(3,4,"CATEGORY.LABELS.LIST")," "),r(2),m("nbSpinner",i.loading),r(),m("settings",i.settings)("source",i.source))},dependencies:[N,O,B,A,be,x],styles:[`[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{transform:translateZ(0)}





`]})}}return t})();var V=class{};var W=class{constructor(){this.meta={scope:"ecommerce"},this.sort_order="1"}};var k=class{};function Ne(t,d){if(t&1&&(a(0,"div",12)(1,"label"),l(2),c(3,"translate"),a(4,"span",24),l(5),c(6,"languageTitle"),o()(),E(7,"input",25),o()),t&2){let e=d.index,n=j();r(2),y("",u(3,3,"CATEGORY.FIELDS.TITLE.LABEL")," "),r(3),f(u(6,5,n.languages[e])),r(2),Z("formControlName",e)}}function De(t,d){if(t&1&&(a(0,"label",26),l(1),o()),t&2){let e=d.$implicit;r(),f(e)}}function xe(t,d){if(t&1&&(a(0,"label",26),l(1),o()),t&2){let e=d.$implicit;r(),f(e)}}function qe(t,d){if(t&1&&(a(0,"label",26),l(1),o()),t&2){let e=d.$implicit;r(),f(e)}}function Ge(t,d){if(t&1&&(a(0,"nb-option",27),l(1),o()),t&2){let e=d.$implicit;m("value",e.id),r(),y(" ",e.title,"")}}function Pe(t,d){if(t&1&&(a(0,"label",26),l(1),o()),t&2){let e=d.$implicit;r(),f(e)}}function Ve(t,d){if(t&1&&(a(0,"a",28),l(1),o()),t&2){let e=j();m("href",e.category==null||e.category.mediaurls==null||e.category.mediaurls.images[0]==null?null:e.category.mediaurls.images[0].default,H),r(),f(e.category==null||e.category.mediaurls==null||e.category.mediaurls.images[0]==null?null:e.category.mediaurls.images[0].default)}}function We(t,d){if(t&1&&(a(0,"label",26),l(1),o()),t&2){let e=d.$implicit;r(),f(e)}}var Q=(()=>{class t{constructor(e,n,i,s){this.client=e,this.coreService=n,this.route=i,this.formBuilder=s,this.category=new V,this.categoryRequest=new W,this.categoryError=new k,this.showProgress=!1,this.showProgressButton=!1,this.parentCategories=[],this.editId=null,this.languages=[],this.languages=n.translationService.languages}ngOnInit(){this.titleGroupForm=this.coreService.translationService.buildFormGroup(null),this.getParentCategories().subscribe(),this.getEditData()}ngAfterViewInit(){}getParentCategories(){return this.client.parent(this.coreService.appConfigService.getConfig().defaultCategoryScope).pipe(Y(e=>(this.parentCategories=e,e)))}getEditData(){let e=this.route.snapshot.paramMap.get("id");e&&(this.editId=e,this.getDataById(e).subscribe())}getDataById(e){return this.showProgress=!0,this.client.show(e).pipe(Y(n=>(this.showProgress=!1,this.category=n,this.titleGroupForm=this.coreService.translationService.buildFormGroup(this.category.title_translations),this.categoryRequest.slug=this.category.slug,this.categoryRequest.parent_id=this.category.parent_id,this.categoryRequest.sort_order=this.category.sort_order,this.categoryRequest.meta=this.category.meta,this.metaeditorComponent.addMetaFields(),n)))}saveCategory(){this.metaeditorComponent.updatedMetaProperty(),this.showProgressButton=!0;let e=new FormData;e.append("title_translations",this.coreService.translationService.buildRequestParam(this.titleGroupForm)),e.append("slug",this.categoryRequest.slug),e.append("sort_order",this.categoryRequest.sort_order),e.append("meta",JSON.stringify(this.categoryRequest.meta)),this.categoryRequest.parent_id&&e.append("parent_id",this.categoryRequest.parent_id),this.categoryRequest.image&&e.append("image",this.categoryRequest.image),(this.editId?this.client.update(this.editId,e):this.client.store(e)).subscribe(i=>{this.showProgressButton=!1,this.coreService.toastService.showToast(z.SUCCESS,"Saved","Saved successfully!"),this.back()},i=>{if(this.showProgressButton=!1,this.coreService.toastService.showToast(z.DANGER,"Failed",i.error.message),i.error.errors){let s=i.error.errors;this.categoryError.title_translations=s?.title_translations,this.categoryError.image=s?.image,this.categoryError.sort_order=s?.sort_order,this.categoryError.slug=s?.slug,this.categoryError.parent_id=s?.parent_id}})}back(){this.coreService.location.back()}getTitleItems(){return this.titleGroupForm.get("items")}onImageChanged(e){let n=e.target.files[0];this.categoryRequest.image=n}static{this.\u0275fac=function(n){return new(n||t)(h(D),h(q),h(M),h(fe))}}static{this.\u0275cmp=S({type:t,selectors:[["save"]],viewQuery:function(n,i){if(n&1&&X(G,5),n&2){let s;$(s=ee())&&(i.metaeditorComponent=s.first)}},decls:62,vars:45,consts:[["form","ngForm"],["slug","ngModel"],["sort_order","ngModel"],["parent_id","ngModel"],[1,"row"],[1,"col-md-12"],["nbSpinnerStatus","danger",3,"nbSpinner"],[3,"ngSubmit"],[3,"formGroup"],["formArrayName","items"],["class","form-group",4,"ngFor","ngForOf"],["class","error text-danger",4,"ngFor","ngForOf"],[1,"form-group"],["icon","info-outline","nbTooltip","Must be unique, all small letter, no space. Example - test-category","nbTooltipStatus","info","status","info"],["type","text","nbInput","","fullWidth","","placeholder","Slug","name","slug","required","",3,"ngModelChange","ngModel"],[1,"error","text-danger",3,"hidden"],["type","number","nbInput","","fullWidth","","placeholder","Sort Order","name","sort_order","required","",3,"ngModelChange","ngModel"],["fullWidth","","name","parent_id",2,"text-transform","capitalize",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","file","nbInput","","fullWidth","",3,"change"],["target","_blank",3,"href",4,"ngIf"],[3,"metaChange","meta"],["type","submit","nbButton","","status","success","size","medium","nbSpinnerStatus","success","nbSpinnerSize","small",3,"disabled","nbSpinner"],["type","button","nbButton","","status","danger","size","medium",3,"click"],[1,"language-label"],["type","text","nbInput","","fullWidth","","required","",3,"formControlName"],[1,"error","text-danger"],[3,"value"],["target","_blank",3,"href"]],template:function(n,i){if(n&1){let s=K();a(0,"div",4)(1,"div",5)(2,"nb-card")(3,"nb-card-body",6)(4,"form",7,0),b("ngSubmit",function(){return _(s),C(i.saveCategory())}),a(6,"div",4)(7,"div",5)(8,"nb-card")(9,"nb-card-header"),l(10),c(11,"translate"),o(),a(12,"nb-card-body")(13,"div",8)(14,"div",9),v(15,Ne,8,7,"div",10),o()(),v(16,De,2,1,"label",11),o()()()(),a(17,"div",12)(18,"label"),l(19),c(20,"translate"),o(),l(21," \xA0"),E(22,"nb-icon",13),a(23,"input",14,1),R("ngModelChange",function(p){return _(s),T(i.categoryRequest.slug,p)||(i.categoryRequest.slug=p),C(p)}),o(),a(25,"label",15),l(26),c(27,"translate"),o(),v(28,xe,2,1,"label",11),o(),a(29,"div",12)(30,"label"),l(31),c(32,"translate"),o(),a(33,"input",16,2),R("ngModelChange",function(p){return _(s),T(i.categoryRequest.sort_order,p)||(i.categoryRequest.sort_order=p),C(p)}),o(),a(35,"label",15),l(36),c(37,"translate"),o(),v(38,qe,2,1,"label",11),o(),a(39,"div",12)(40,"label"),l(41),c(42,"translate"),o(),a(43,"nb-select",17,3),R("ngModelChange",function(p){return _(s),T(i.categoryRequest.parent_id,p)||(i.categoryRequest.parent_id=p),C(p)}),v(45,Ge,2,2,"nb-option",18),o(),v(46,Pe,2,1,"label",11),o(),a(47,"div",12)(48,"label"),l(49),c(50,"translate"),o(),a(51,"input",19),b("change",function(p){return _(s),C(i.onImageChanged(p))}),o(),v(52,Ve,2,2,"a",20)(53,We,2,1,"label",11),o(),a(54,"ngx-metaeditor",21),R("metaChange",function(p){return _(s),T(i.categoryRequest.meta,p)||(i.categoryRequest.meta=p),C(p)}),o(),a(55,"button",22),l(56),c(57,"translate"),o(),l(58," \xA0 "),a(59,"button",23),b("click",function(){return _(s),C(i.back())}),l(60),c(61,"translate"),o()()()()()()}if(n&2){let s=F(5),g=F(24),p=F(34);r(3),m("nbSpinner",i.showProgress),r(7),f(u(11,27,"CATEGORY.FIELDS.TITLE.HEADER")),r(3),m("formGroup",i.titleGroupForm),r(2),m("ngForOf",i.getTitleItems().controls),r(),m("ngForOf",i.categoryError.title_translations),r(3),f(u(20,29,"CATEGORY.FIELDS.SLUG.LABEL")),r(4),I("ngModel",i.categoryRequest.slug),r(2),m("hidden",g.valid||g.pristine),r(),y(" ",u(27,31,"CATEGORY.FIELDS.SLUG.VALIDATION")," "),r(2),m("ngForOf",i.categoryError.slug),r(3),f(u(32,33,"CATEGORY.FIELDS.SORT_ORDER.LABEL")),r(2),I("ngModel",i.categoryRequest.sort_order),r(2),m("hidden",p.valid||p.pristine),r(),y(" ",u(37,35,"CATEGORY.FIELDS.SORT_ORDER.VALIDATION")," "),r(2),m("ngForOf",i.categoryError.sort_order),r(3),f(u(42,37,"CATEGORY.FIELDS.PARENT.LABEL")),r(2),I("ngModel",i.categoryRequest.parent_id),r(2),m("ngForOf",i.parentCategories),r(),m("ngForOf",i.categoryError.parent_id),r(3),f(u(50,39,"CATEGORY.FIELDS.IMAGE.LABEL")),r(3),m("ngIf",(i.category==null||i.category.mediaurls==null||i.category.mediaurls.images==null?null:i.category.mediaurls.images.length)>0),r(),m("ngForOf",i.categoryError.image),r(),I("meta",i.categoryRequest.meta),r(),m("disabled",!s.form.valid||i.showProgressButton)("nbSpinner",i.showProgressButton),r(),y(" ",u(57,41,"COMMON.SAVE")," "),r(4),y(" ",u(61,43,"COMMON.BACK")," ")}},dependencies:[te,ie,pe,ne,me,oe,ae,ge,le,se,de,ue,ce,ye,Se,ve,he,N,O,B,A,Ce,_e,G,x,Ee],encapsulation:2})}}return t})();var ke=[{path:"",component:we,children:[{path:"add",component:Q},{path:"list",component:Le},{path:"edit/:id",component:Q}]}],Fe=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=L({type:t})}static{this.\u0275inj=w({imports:[U.forChild(ke),U]})}}return t})();var ft=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=L({type:t})}static{this.\u0275inj=w({imports:[Ie,Fe]})}}return t})();export{ft as CategoriesModule};
