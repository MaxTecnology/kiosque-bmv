import{a as T}from"./chunk-G54L7PON.js";import{a as Ce}from"./chunk-O7WP6NWV.js";import{a as Ie}from"./chunk-2TO534EY.js";import"./chunk-RSPORLB7.js";import{$ as ee,Cb as he,F as $,Fb as M,G as n,H as f,J,K as v,Kb as ve,Lb as _e,M as p,O as a,Oa as N,P as o,Pa as ne,Q as E,Sa as Q,T as K,Ta as re,U as y,Ua as oe,V as G,Va as ae,Wa as se,Xa as le,Y,Ya as pe,Z,Za as me,_ as X,_a as de,aa as k,ab as ce,ba as l,bb as ue,ca as g,cb as ge,da as h,e as V,ec as Se,fa as j,ga as W,gb as fe,gc as L,ha as z,jc as H,kb as F,lb as R,lc as A,ma as c,na as u,nb as w,nc as ye,ob as be,p as I,s as _,sc as D,t as B,ta as te,tc as Ee,ua as ie,x as S,y as C}from"./chunk-K77LY3FL.js";import"./chunk-B4AJQJMI.js";var Ne=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=_({type:t,selectors:[["banners"]],decls:1,vars:0,template:function(r,i){r&1&&E(0,"router-outlet")},dependencies:[ne],encapsulation:2})}}return t})();var Fe=(()=>{class t extends Ie{constructor(e,r,i){super(r),this.client=e,this.coreService=r,this.route=i,this.columns=[{key:"title",translation_key:"BANNER.FIELDS.TITLE.LABEL",column:{title:"",type:"string"}},{key:"meta",translation_key:"BANNER.FIELDS.META_SCOPE.LABEL",column:{title:"",type:"string",filter:!1,valuePrepareFunction:s=>s.scope}}],this.editPageUrl="pages/banners/edit",this.actionSettings={actions:{columnTitle:"Action",position:"right",add:!1}}}ngOnInit(){super.ngOnInit(this.client.getBaseEndpoint())}static{this.\u0275fac=function(r){return new(r||t)(f(T),f(A),f(N))}}static{this.\u0275cmp=_({type:t,selectors:[["list"]],features:[J],decls:6,vars:6,consts:[["nbSpinnerStatus","danger",3,"nbSpinner"],[3,"delete","edit","settings","source"]],template:function(r,i){r&1&&(a(0,"nb-card")(1,"nb-card-header"),l(2),c(3,"translate"),o(),a(4,"nb-card-body",0)(5,"angular2-smart-table",1),y("delete",function(m){return i.onDeleteConfirm(m)})("edit",function(m){return i.edit(m)}),o()()()),r&2&&(n(2),h(" ",u(3,4,"BANNER.LABELS.LIST")," "),n(2),p("nbSpinner",i.loading),n(),p("settings",i.settings)("source",i.source))},dependencies:[M,w,R,F,Se,L],styles:[`[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{transform:translateZ(0)}





`]})}}return t})();var O=class{};var q=class{constructor(){this.meta={scope:"ecommerce"},this.sort_order="1"}};var P=class{};function Ae(t,d){if(t&1&&(a(0,"div",11)(1,"label"),l(2),c(3,"translate"),a(4,"span",21),l(5),c(6,"languageTitle"),o()(),E(7,"input",22),o()),t&2){let e=d.index,r=G();n(2),h("",u(3,3,"BANNER.FIELDS.TITLE.LABEL")," "),n(3),g(u(6,5,r.languages[e])),n(2),Y("formControlName",e)}}function De(t,d){if(t&1&&(a(0,"label",23),l(1),o()),t&2){let e=d.$implicit;n(),g(e)}}function xe(t,d){if(t&1&&(a(0,"label",23),l(1),o()),t&2){let e=d.$implicit;n(),g(e)}}function Oe(t,d){if(t&1&&(a(0,"nb-option",24),l(1),o()),t&2){let e=d.$implicit;p("value",e.id),n(),h(" ",e.title,"")}}function qe(t,d){if(t&1&&(a(0,"label",23),l(1),o()),t&2){let e=d.$implicit;n(),g(e)}}function Pe(t,d){if(t&1&&(a(0,"a",25),l(1),o()),t&2){let e=G();p("href",e.banner==null||e.banner.mediaurls==null||e.banner.mediaurls.images[0]==null?null:e.banner.mediaurls.images[0].default,$),n(),g(e.banner==null||e.banner.mediaurls==null||e.banner.mediaurls.images[0]==null?null:e.banner.mediaurls.images[0].default)}}function Ve(t,d){if(t&1&&(a(0,"label",23),l(1),o()),t&2){let e=d.$implicit;n(),g(e)}}var U=(()=>{class t{constructor(e,r,i,s,m){this.client=e,this.coreService=r,this.route=i,this.formBuilder=s,this.categryClient=m,this.banner=new O,this.bannerRequest=new q,this.bannerError=new P,this.showProgress=!1,this.showProgressButton=!1,this.parentBanners=[],this.editId=null,this.languages=[],this.categories=[],this.languages=r.translationService.languages}ngOnInit(){this.titleGroupForm=this.coreService.translationService.buildFormGroup(null),this.getCategories().subscribe(),this.getEditData()}ngAfterViewInit(){this.editId||this.metaeditorComponent.addMetaFields()}getCategories(){return this.categryClient.parent(this.coreService.appConfigService.getConfig().defaultCategoryScope).pipe(V(e=>(this.categories=e,e)))}getEditData(){let e=this.route.snapshot.paramMap.get("id");e&&(this.editId=e,this.getDataById(e).subscribe())}getDataById(e){return this.showProgress=!0,this.client.show(e).pipe(V(r=>(this.showProgress=!1,this.banner=r,this.titleGroupForm=this.coreService.translationService.buildFormGroup(this.banner.title_translations),this.bannerRequest.sort_order=this.banner.sort_order,this.bannerRequest.meta=this.banner.meta,this.banner.category&&(this.bannerRequest.category_id=this.banner.category.id),this.metaeditorComponent.addMetaFields(),r)))}saveBanner(){this.metaeditorComponent.updatedMetaProperty(),this.showProgressButton=!0;let e=new FormData;e.append("title_translations",this.coreService.translationService.buildRequestParam(this.titleGroupForm)),e.append("sort_order",this.bannerRequest.sort_order),e.append("meta",JSON.stringify(this.bannerRequest.meta)),this.bannerRequest.category_id&&e.append("category_id",this.bannerRequest.category_id),this.bannerRequest.image&&e.append("image",this.bannerRequest.image),(this.editId?this.client.update(this.editId,e):this.client.store(e)).subscribe(i=>{this.showProgressButton=!1,this.coreService.toastService.showToast(H.SUCCESS,"Saved","Saved successfully!"),this.back()},i=>{if(this.showProgressButton=!1,this.coreService.toastService.showToast(H.DANGER,"Failed",i.error.message),i.error.errors){let s=i.error.errors;this.bannerError.title_translations=s?.title_translations,this.bannerError.image=s?.image,this.bannerError.sort_order=s?.sort_order}})}back(){this.coreService.location.back()}getTitleItems(){return this.titleGroupForm.get("items")}onImageChanged(e){let r=e.target.files[0];this.bannerRequest.image=r}static{this.\u0275fac=function(r){return new(r||t)(f(T),f(A),f(N),f(fe),f(Ce))}}static{this.\u0275cmp=_({type:t,selectors:[["save"]],viewQuery:function(r,i){if(r&1&&Z(D,5),r&2){let s;X(s=ee())&&(i.metaeditorComponent=s.first)}},decls:50,vars:36,consts:[["form","ngForm"],["sort_order","ngModel"],["category_id","ngModel"],[1,"row"],[1,"col-md-12"],["nbSpinnerStatus","danger",3,"nbSpinner"],[3,"ngSubmit"],[3,"formGroup"],["formArrayName","items"],["class","form-group",4,"ngFor","ngForOf"],["class","error text-danger",4,"ngFor","ngForOf"],[1,"form-group"],["type","number","nbInput","","fullWidth","","placeholder","Sort Order","name","sort_order","required","",3,"ngModelChange","ngModel"],[1,"error","text-danger",3,"hidden"],["fullWidth","","name","category_id",2,"text-transform","capitalize",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","file","nbInput","","fullWidth","",3,"change"],["target","_blank",3,"href",4,"ngIf"],[3,"meta"],["type","submit","nbButton","","status","success","size","medium","nbSpinnerStatus","success","nbSpinnerSize","small",3,"disabled","nbSpinner"],["type","button","nbButton","","status","danger","size","medium",3,"click"],[1,"language-label"],["type","text","nbInput","","fullWidth","","required","",3,"formControlName"],[1,"error","text-danger"],[3,"value"],["target","_blank",3,"href"]],template:function(r,i){if(r&1){let s=K();a(0,"div",3)(1,"div",4)(2,"nb-card")(3,"nb-card-body",5)(4,"form",6,0),y("ngSubmit",function(){return S(s),C(i.saveBanner())}),a(6,"div",3)(7,"div",4)(8,"nb-card")(9,"nb-card-header"),l(10),c(11,"translate"),o(),a(12,"nb-card-body")(13,"div",7)(14,"div",8),v(15,Ae,8,7,"div",9),o()(),v(16,De,2,1,"label",10),o()()()(),a(17,"div",11)(18,"label"),l(19),c(20,"translate"),o(),a(21,"input",12,1),z("ngModelChange",function(b){return S(s),W(i.bannerRequest.sort_order,b)||(i.bannerRequest.sort_order=b),C(b)}),o(),a(23,"label",13),l(24),c(25,"translate"),o(),v(26,xe,2,1,"label",10),o(),a(27,"div",11)(28,"label"),l(29),c(30,"translate"),o(),a(31,"nb-select",14,2),z("ngModelChange",function(b){return S(s),W(i.bannerRequest.category_id,b)||(i.bannerRequest.category_id=b),C(b)}),v(33,Oe,2,2,"nb-option",15),o(),v(34,qe,2,1,"label",10),o(),a(35,"div",11)(36,"label"),l(37),c(38,"translate"),o(),a(39,"input",16),y("change",function(b){return S(s),C(i.onImageChanged(b))}),o(),v(40,Pe,2,2,"a",17)(41,Ve,2,1,"label",10),o(),E(42,"ngx-metaeditor",18),a(43,"button",19),l(44),c(45,"translate"),o(),l(46," \xA0 "),a(47,"button",20),y("click",function(){return S(s),C(i.back())}),l(48),c(49,"translate"),o()()()()()()}if(r&2){let s=k(5),m=k(22);n(3),p("nbSpinner",i.showProgress),n(7),g(u(11,22,"BANNER.FIELDS.TITLE.HEADER")),n(3),p("formGroup",i.titleGroupForm),n(2),p("ngForOf",i.getTitleItems().controls),n(),p("ngForOf",i.bannerError.title_translations),n(3),g(u(20,24,"BANNER.FIELDS.SORT_ORDER.LABEL")),n(2),j("ngModel",i.bannerRequest.sort_order),n(2),p("hidden",m.valid||m.pristine),n(),h(" ",u(25,26,"BANNER.FIELDS.SORT_ORDER.VALIDATION")," "),n(2),p("ngForOf",i.bannerError.sort_order),n(3),g(u(30,28,"BANNER.FIELDS.CATEGORY.LABEL")),n(2),j("ngModel",i.bannerRequest.category_id),n(2),p("ngForOf",i.categories),n(),p("ngForOf",i.bannerError.category_id),n(3),g(u(38,30,"BANNER.FIELDS.IMAGE.LABEL")),n(3),p("ngIf",(i.banner==null||i.banner.mediaurls==null||i.banner.mediaurls.images==null?null:i.banner.mediaurls.images.length)>0),n(),p("ngForOf",i.bannerError.image),n(),p("meta",i.bannerRequest.meta),n(),p("disabled",!s.form.valid||i.showProgressButton)("nbSpinner",i.showProgressButton),n(),h(" ",u(45,32,"COMMON.SAVE")," "),n(4),h(" ",u(49,34,"COMMON.BACK")," ")}},dependencies:[te,ie,pe,re,me,oe,ae,ge,le,se,de,ue,ce,be,_e,ve,M,w,R,F,he,D,L,ye],encapsulation:2})}}return t})();var Ge=[{path:"",component:Ne,children:[{path:"add",component:U},{path:"list",component:Fe},{path:"edit/:id",component:U}]}],Re=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=B({type:t})}static{this.\u0275inj=I({imports:[Q.forChild(Ge),Q]})}}return t})();var gt=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=B({type:t})}static{this.\u0275inj=I({imports:[Ee,Re]})}}return t})();export{gt as BannersModule};
